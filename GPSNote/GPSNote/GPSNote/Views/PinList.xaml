<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:prism="http://prismlibrary.com"
             prism:ViewModelLocator.AutowireViewModel="True"
             x:Class="GPSNote.Views.PinList"
             BackgroundColor="{AppThemeBinding Light={StaticResource LightPageBackgroundColor}, Dark={StaticResource DarkPageBackgroundColor}}"
             Title="{Binding Resources[PinListTitle]}">


    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="0.1*" />
            <RowDefinition Height="0.9*" />
        </Grid.RowDefinitions>


        <Label Text="{Binding Resources[NoPins]}" 
               HorizontalOptions="Center"
               VerticalOptions="Center"
               IsVisible="{Binding IsVisible}"></Label>

        <SearchBar Grid.Row="0" 
                   Placeholder="Search"
                   BackgroundColor="AliceBlue"
                   TextColor="Black"
                   PlaceholderColor="Gray"
                   Text="{Binding SearchBarText}">
            
            <SearchBar.Behaviors>
                <prism:EventToCommandBehavior
                            EventName="TextChanged"
                            Command="{Binding OnSearchBarTypingCommand}"
                            CommandParameter="MyParameter"  />

            </SearchBar.Behaviors>
        </SearchBar>

        <ListView Grid.Row="1" ItemsSource="{Binding PinObs}" 
                  RowHeight="100" 
                  Margin="10"
                  SelectedItem="{Binding SelectedItem}"
                  x:Name="ListView1"
                  BackgroundColor="Transparent">



            <ListView.ItemTemplate>
                <DataTemplate>
                    <ViewCell>
                        <ViewCell.ContextActions>
                            <MenuItem Text="{Binding Path=BindingContext.Resources[Edit], 
                                                            Source={x:Reference ListView1}}" 
                                          Command="{Binding Path=BindingContext.EditCommandTap, 
                                                            Source={x:Reference ListView1}}" 
                                          CommandParameter="{Binding .}"/>
                            <MenuItem Text="{Binding Path=BindingContext.Resources[Delete], 
                                                            Source={x:Reference ListView1}}" 
                                          Command="{Binding Path=BindingContext.DeleteCommandTap, 
                                                            Source={x:Reference ListView1}}" 
                                          CommandParameter="{Binding .}"/>
                        </ViewCell.ContextActions>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.2*"/>
                                <ColumnDefinition Width="0.8*"/>
                            </Grid.ColumnDefinitions>

                            <Image Grid.RowSpan="3" Source="disabled.png"  Aspect="AspectFit" Margin="5" >
                                <Image.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Path=BindingContext.ImageCommandTap, 
                                                                    Source={x:Reference ListView1}}" 
                                                  CommandParameter="{Binding .}"/>
                                </Image.GestureRecognizers>
                            </Image>


                            <Image Grid.RowSpan="3" Source="favorite.png"  Aspect="AspectFit" Margin="5" IsVisible="{Binding IsEnabled}">
                                <Image.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Path=BindingContext.ImageCommandTap, 
                                                                    Source={x:Reference ListView1}}" 
                                                  CommandParameter="{Binding .}"/>
                                </Image.GestureRecognizers>
                            </Image>



                            <Label Grid.Column="1" Grid.Row="0" Text="{Binding Label}" FontAttributes="Bold" />
                            <Label Grid.Column="1" Grid.Row="1" Text="{Binding Latitude}" />
                            <Label Grid.Column="1" Grid.Row="2" Text="{Binding Longitude}" />

                        </Grid>

                    </ViewCell>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>


        <Button Grid.Row="1" 
            BackgroundColor="{AppThemeBinding Light={StaticResource LightNavigationBarColor}, Dark={StaticResource DarkNavigationBarColor}}"
            BorderColor="{AppThemeBinding Light={StaticResource DarkPageBackgroundColor}, Dark={StaticResource LightPageBackgroundColor}}"
            CornerRadius="50"
            BorderWidth="7"
            WidthRequest="100" 
            HeightRequest="100"            
            VerticalOptions="End"
            HorizontalOptions="End"
            Margin="0,0,20,20"
            Command="{Binding AddEditButtonClicked}"           
            ImageSource="ic_add.png"/>
    </Grid>



</ContentPage>